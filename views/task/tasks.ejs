<main>
<% if (flashMessage.error) { %>
<h4 class="py-4 text-center bg-danger text-white">
  <%= flashMessage.error %>
</h4>
<% } %>
<% if (flashMessage.success) { %>
<h4 class="py-4 text-center bg-success text-white">
  <%= flashMessage.success %>
</h4>
<% } %>
<section class="py-4">
<div class="container">
  <h2 class="my-4 text-capitalize">
    your tasks
  </h2>
  <div class="d-flex justify-content-between">
    <a class="mb-3 btn btn-primary text-white text-capitalize fw-bold" href="/user/<%= user.id %>/tasks/new" >
      <i class="bi bi-plus-circle"></i>
      new task
    </a>
    <div>
      <button class="btn border border-1 border-dark-subtle">
        <i class="bi bi-grid h5"></i>
      </button>
      <button class="btn border border-1 border-dark-subtle">
        <i class="bi bi-list h5"></i>
      </button>
    </div>
  </div>
  <div class="mt-3 row">
    <div class="col-12 col-md-4 col-lg-3">
      <form>
        <% for (const filter in filters) { %>
        <% if (filters[filter].length > 0) { %>
        <div class="mb-3">
          <h6 class="fw-bold">
            <%= filter %>
          </h6>
          <div class="form-check d-flex flex-column">
            <% filters[filter].forEach((option) => { %>
            <label class="form-check-label">
              <input type="checkbox"
                class="form-check-input"
                name="<%= filter %>"
                value="<%= option %>"
                <% if(Object.values(query).flat().includes(option)) {%>
                checked
                <%}%>
              />
                <%= option %>
                </label>
                <% }); %>
              </div>
            </div>
            <% } %>
            <% } %>
            <button class="btn border border-1 border-dark-subtle" type="submit">
              <i class="bi bi-funnel"></i>
              apply
            </button>
            <a class="btn border border-1 border-dark-subtle" href="/user/<%= user.id %>/tasks">
              <i class="bi bi-arrow-clockwise"></i>
              clear
            </a>
          </form>
        </div>
        <div class="col-12 col-md-8 col-lg-9">
          <% if (tasks.length < 1) { %>
            <h5 class="fw-bold">
              Currently there are no tasks to be displayed.
            </h5>
            <% } %>
            <div class="row g-4">
              <% const colors = ['primary', 'secondary', 'success', 'danger', 'warning', 'info', 'light', 'dark'] %>
              <% tasks.forEach((task, index) => { %>
              <div class="col-12 col-md-6 col-lg-4">
                <div class="card border border-top shadow">
                  <div class="card-body border-top border-5 border-<%= colors[index % colors.length] %> rounded text-capitalize">
                    <h5 class="card-title text-secondary fw-bold">
                      task <%= index + 1 %>
                    </h5>
                    <% if (task.project) { %>
                    <h6 class="card-subtitle mb-2 text-secondary">
                      <%= task.project %>
                    </h6>
                    <% } %>
                    <p class="card-text fw-bold">
                      <%= task.description %>
                    </p>
                    <ul class="list-unstyled text-secondary">
                      <li>
                        <%= task.getElapsedTime(task.age) %> ago
                      </li>
                      <li>
                        priority: <%= task.priority %>
                      </li>
                      <% if (task.due) { %>
                      <li>
                        due: <%= task.toLocaleDateString(task.due) %>
                      </li>
                      <% } %>
                      <% if (task.status === 'started' || task.status === 'finished') { %>
                      <li>
                        <% if (task.status === 'started') { %>
                        started: <%= task.toLocaleDateString(task.started) %>
                        <% } %>

                        <% if (task.status === 'finished') { %>
                        finished: <%= task.toLocaleDateString(task.finished) %>
                        <% } %>
                      </li>
                      <% } %>
                    </ul>
                    <a class="btn btn-outline-dark" href="/user/<%= user.id %>/tasks/<%= task._id %>/edit">
                      <i class="bi bi-pencil"></i>
                    </a>
                    <a href="/user/<%= user.id %>/tasks/<%= task._id %>?_method=DELETE"
                      class="btn btn-outline-danger"
                      onclick="return confirm('are you sure you want to delete this task?')"
                    >
                      <i class="bi bi-trash2"></i>
                    </a>
                  </div>
                </div>
              </div>
              <% }); %>
            </div>
        </div>
      </div>
      <% if (tasks.length > 0) { %>
      <div class="d-flex justify-content-end">
        <a href="/user/<%= user.id %>/tasks?_method=DELETE"
          class="mt-3 btn btn-danger text-capitalize"
          onclick="return confirm('are you sure you want to delete all tasks?')"
        >
          delete all tasks
        </a>
      </div>
      <% } %>
    </div>
  </section>
</main>

